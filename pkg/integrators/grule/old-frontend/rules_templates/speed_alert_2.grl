// name: Speed Alert con Auditor√≠a Universal
// category: Alertas
// description: Detecta veh√≠culos en movimiento y registra auditor√≠a autom√°ticamente

rule SpeedAlert "Alerta de Velocidad" salience 100 {
    when
        // Condiciones: veh√≠culo en movimiento con velocidad > 0
        IncomingPacket.Speed > 0 &&
        IncomingPacket.Latitude != 0.0 &&
        IncomingPacket.Longitude != 0.0
    then
        // ‚úÖ AUDITOR√çA UNIVERSAL: Captura autom√°tica del contexto
        // No necesita par√°metros complejos - todo se captura autom√°ticamente
        actions.Audit("SpeedAlert", "Veh√≠culo en movimiento detectado", 100, true);
        
        // Ejecutar acciones reales
        actions.SendTelegram(
            "üöó *Alerta de Movimiento*\n" +
            "IMEI: " + IncomingPacket.IMEI + "\n" +
            "Velocidad: " + IncomingPacket.Speed + " km/h\n" +
            "Coordenadas: " + IncomingPacket.Latitude + ", " + IncomingPacket.Longitude
        );
        
        actions.Log("SpeedAlert ejecutada para IMEI: %s, Speed: %v", IncomingPacket.IMEI, IncomingPacket.Speed);
        
        Retract("SpeedAlert");
}
