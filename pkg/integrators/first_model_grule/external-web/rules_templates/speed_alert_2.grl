// name: Speed Alert con Auditor√≠a Universal
// category: Alertas
// description: Detecta veh√≠culos en movimiento y registra auditor√≠a autom√°ticamente

rule SpeedAlert "Alerta de Velocidad" salience 100 {
    when
        // Condiciones: veh√≠culo en movimiento con velocidad > 0
        Jono.Speed > 0 &&
        Jono.Latitude != 0.0 &&
        Jono.Longitude != 0.0
    then
        // ‚úÖ AUDITOR√çA UNIVERSAL: Captura autom√°tica del contexto
        // No necesita par√°metros complejos - todo se captura autom√°ticamente
        actions.Audit("SpeedAlert", "Veh√≠culo en movimiento detectado", 100, true);
        
        // Ejecutar acciones reales
        actions.SendTelegram(
            "üöó *Alerta de Movimiento*\n" +
            "IMEI: " + Jono.IMEI + "\n" +
            "Velocidad: " + Jono.Speed + " km/h\n" +
            "Coordenadas: " + Jono.Latitude + ", " + Jono.Longitude
        );
        
        actions.Log("SpeedAlert ejecutada para IMEI: %s, Speed: %v", Jono.IMEI, Jono.Speed);
        
        Retract("SpeedAlert");
}
